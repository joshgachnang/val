machine:
  node:
    version: 8
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
#  services:
#    - docker

dependencies:
  override:
    - yarn
    - yarn global add typescript
  cache_directories:
    - ~/.cache/yarn

test:
  override:
    - yarn test

#  post:
#    - docker build -t servercobra/val .

#test:
#  post:
#    - docker run -d -p 8080:8080 --name val servercobra/val; sleep 10
#    - curl --retry 10 --retry-delay 5 localhost:8080/healthcheck | grep "ok"
    # Check deployed alexa apps
#    - curl --retry 10 --retry-delay 5 localhost:8080/productivity/flashbriefing | grep "titleText"
#    - curl --retry 10 --retry-delay 5 localhost:8080/dogecoin/flashbriefing | grep "titleText"

#deployment:
#  prod:
#    branch: master
#    commands:
#      - ./ecs-deploy.sh
#      - "curl -X POST -H 'Content-type: application/json' --data '{\"text\":\"Successfully deployed bot to ECS.\"}' $SLACK_WEBHOOK_URL"
